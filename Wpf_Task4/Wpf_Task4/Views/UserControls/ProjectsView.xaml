<!-- Main Projects management view with two-panel layout -->
<UserControl x:Class="Wpf_Task4.Views.UserControls.ProjectsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:Wpf_Task4.Models"
             xmlns:converters="clr-namespace:Wpf_Task4.Converters"
             xmlns:local="clr-namespace:Wpf_Task4.Views.UserControls">

    <UserControl.Resources>
        <!-- Register converters for use in this control -->
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <!-- Projects list -->
            <ColumnDefinition Width="*"/>
            <!-- Details panel -->
        </Grid.ColumnDefinitions>

        <!-- LEFT PANEL: Projects list -->
        <StackPanel Grid.Column="0">
            <!-- Language switcher -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="RU" 
                        Command="{Binding Source={StaticResource LangVM}, Path=SetLangRuCommand}"/>
                <Button Content="EN" 
                        Command="{Binding Source={StaticResource LangVM}, Path=SetLangEnCommand}"/>
                <Button Content="BE" 
                        Command="{Binding Source={StaticResource LangVM}, Path=SetLangBeCommand}"/>
            </StackPanel>

            <!-- Current user display -->
            <TextBlock Text="{Binding CurrentUserLogin}"
                       FontWeight="Bold"
                       Margin="0,0,0,10"/>

            <!-- Add project button -->
            <Button Content="{DynamicResource PlusProj}"
                    Command="{Binding ShowAddProjectPopupCommand}"
                    Margin="0,0,0,10"/>

            <!-- Scrollable projects list -->
            <ScrollViewer VerticalScrollBarVisibility="Auto" 
                          MaxHeight="400">
                <ListBox ItemsSource="{Binding Projects}"
                         SelectedItem="{Binding SelectedProject}"
                         DisplayMemberPath="Name"/>
            </ScrollViewer>
        </StackPanel>

        <!-- RIGHT PANEL: Project details and tasks -->
        <Grid Grid.Column="1" Margin="10,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- Project info -->
                <RowDefinition Height="*"/>
                <!-- Tasks list -->
            </Grid.RowDefinitions>

            <!-- 1. PROJECT INFORMATION -->
            <Border Grid.Row="0"
                    BorderThickness="1"
                    BorderBrush="LightGray"
                    Background="#F5F5F5"
                    Padding="10"
                    Margin="0,0,0,15"
                    CornerRadius="5"
                    Visibility="{Binding SelectedProject, Converter={StaticResource NullToVisibilityConverter}}">

                <StackPanel>
                    <!-- Header with action buttons -->
                    <DockPanel Margin="0,0,0,8">
                        <TextBlock Text="{DynamicResource ProjInf}" 
                                   FontWeight="Bold" 
                                   FontSize="14"
                                   DockPanel.Dock="Left"/>

                        <!-- Edit project button -->
                        <Button Content="{DynamicResource EditDesc}"
                                DockPanel.Dock="Right"
                                Command="{Binding EditProjectCommand}"
                                CommandParameter="{Binding SelectedProject}"
                                Padding="8,3"
                                FontSize="12"
                                Background="#2196F3"
                                Foreground="White"
                                Width="120" />

                        <!-- Delete project button -->
                        <Button Content="{DynamicResource Del}"
                                DockPanel.Dock="Right"
                                Command="{Binding DeleteProjectCommand}"
                                CommandParameter="{Binding SelectedProject}"
                                Padding="8,3"
                                FontSize="12"
                                Background="#F44336"
                                Foreground="White"
                                Width="120"/>
                    </DockPanel>

                    <!-- Project details grid -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Project ID -->
                        <TextBlock Grid.Row="0" Grid.Column="0"
                                   Text="{DynamicResource ID}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,5,5"/>
                        <TextBlock Grid.Row="0" Grid.Column="1"
                                   Text="{Binding SelectedProject.Id}"
                                   Margin="0,0,0,5"/>

                        <!-- Project name -->
                        <TextBlock Grid.Row="1" Grid.Column="0"
                                   Text="{DynamicResource Name}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,5,5"/>
                        <TextBlock Grid.Row="1" Grid.Column="1"
                                   Text="{Binding SelectedProject.Name}"
                                   FontSize="13"
                                   Margin="0,0,0,5"/>

                        <!-- Creation date -->
                        <TextBlock Grid.Row="2" Grid.Column="0"
                                   Text="{DynamicResource Created}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,5,5"/>
                        <TextBlock Grid.Row="2" Grid.Column="1"
                                   Margin="0,0,0,5">
                            <TextBlock.Text>
                                <Binding Path="SelectedProject.CreatedAt" StringFormat="dd.MM.yyyy HH:mm"/>
                            </TextBlock.Text>
                        </TextBlock>

                        <!-- Project description -->
                        <TextBlock Grid.Row="3" Grid.Column="0"
                                   Text="{DynamicResource Desc}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,5,5"/>
                        <TextBlock Grid.Row="3" Grid.Column="1"
                                   Text="{Binding SelectedProject.Description}"
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,0">
                            <!-- Show placeholder if description is empty/null -->
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedProject.Description}" Value="{x:Null}">
                                            <Setter Property="Text" Value="{DynamicResource NoDescription}"/>
                                            <Setter Property="Foreground" Value="Gray"/>
                                            <Setter Property="FontStyle" Value="Italic"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding SelectedProject.Description}" Value="">
                                            <Setter Property="Text" Value="{DynamicResource NoDescription}"/>
                                            <Setter Property="Foreground" Value="Gray"/>
                                            <Setter Property="FontStyle" Value="Italic"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- "Select project" message (shown when no project selected) -->
            <Border Grid.Row="0"
                    BorderThickness="1"
                    BorderBrush="#FF9800"
                    Background="#FFF3E0"
                    Padding="15"
                    Margin="0,0,0,15"
                    CornerRadius="5"
                    Visibility="{Binding SelectedProject, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=true}">
                <TextBlock Text="{DynamicResource SelectProject}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Foreground="#E65100"
                           TextWrapping="Wrap"
                           TextAlignment="Center"/>
            </Border>

            <!-- 2. PROJECT TASKS (only shown when project selected) -->
            <StackPanel Grid.Row="1"
                        Visibility="{Binding SelectedProject, Converter={StaticResource NullToVisibilityConverter}}">

                <TextBlock Text="{DynamicResource ProjTasks}" 
                           FontWeight="Bold"
                           Margin="0,0,0,10"/>

                <!-- Scrollable tasks list -->
                <ScrollViewer VerticalScrollBarVisibility="Auto" 
                              MaxHeight="250">
                    <ItemsControl ItemsSource="{Binding ProjectTasks}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderThickness="1" 
                                        BorderBrush="LightGray" 
                                        Padding="10" 
                                        Margin="0,0,0,8"
                                        CornerRadius="3"
                                        Background="White">
                                    <StackPanel>
                                        <!-- Task header with edit button -->
                                        <DockPanel>
                                            <TextBlock Text="{Binding Title}"
                                                       FontWeight="Bold"
                                                       DockPanel.Dock="Left"/>
                                            <Button Content="{DynamicResource EditDesc}"
                                                    Width="120"
                                                    DockPanel.Dock="Right"
                                                    Command="{Binding DataContext.EditTaskCommand, 
                                                              RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    CommandParameter="{Binding}"/>
                                        </DockPanel>

                                        <!-- Task description -->
                                        <TextBlock Text="{Binding Description}"
                                                   Margin="0,5,0,8"
                                                   TextWrapping="Wrap"
                                                   FontSize="12"
                                                   Foreground="#666">
                                            <!-- Placeholder for empty description -->
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Description}" Value="{x:Null}">
                                                            <Setter Property="Text" Value="{DynamicResource NoDescription}"/>
                                                            <Setter Property="Foreground" Value="#999"/>
                                                            <Setter Property="FontStyle" Value="Italic"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Description}" Value="">
                                                            <Setter Property="Text" Value="{DynamicResource NoDescription}"/>
                                                            <Setter Property="Foreground" Value="#999"/>
                                                            <Setter Property="FontStyle" Value="Italic"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                        <!-- Creation date -->
                                        <TextBlock>
                                            <TextBlock.Text>
                                                <MultiBinding StringFormat="{}{0} {1:dd.MM.yyyy HH:mm}">
                                                    <Binding Source="{DynamicResource TaskCreated}" />
                                                    <Binding Path="CreatedAt" />
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>

                                        <!-- Status selector -->
                                        <ComboBox ItemsSource="{Binding DataContext.TaskStatuses,
                                                  RelativeSource={RelativeSource AncestorType=Window}}"
                                                  SelectedItem="{Binding Status, Mode=TwoWay}"
                                                  Width="150"
                                                  Margin="0,0,0,5"/>

                                        <!-- Delete task button -->
                                        <Button Content="{DynamicResource Del}"
                                                Command="{Binding DataContext.DeleteTaskCommand, 
                                                          RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                CommandParameter="{Binding}"
                                                HorizontalAlignment="Left"
                                                Padding="8,3"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <Separator Margin="0,15,0,10"/>

                <!-- Add new task form -->
                <StackPanel>
                    <Label Content="{DynamicResource PlusTask}" 
                           FontWeight="Bold"
                           Padding="0,0,0,2"/>

                    <StackPanel Margin="0,5">
                        <Label Content="{DynamicResource Name}" 
                               FontWeight="SemiBold"
                               Padding="0,0,0,2"/>
                        <TextBox Text="{Binding NewTaskTitle}"
                                 Margin="0,0,0,8"/>

                        <Label Content="{DynamicResource Desc}" 
                               FontWeight="SemiBold"
                               Padding="0,0,0,2"/>
                        <TextBox Text="{Binding NewTaskDescription}"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 MinHeight="60"
                                 VerticalScrollBarVisibility="Auto"
                                 Margin="0,0,0,8"/>
                    </StackPanel>

                    <Button Content="{DynamicResource AddTask}"
                            Command="{Binding AddTaskCommand}"
                            HorizontalAlignment="Left"
                            Padding="12,5"/>
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Edit item popup -->
        <Popup IsOpen="{Binding IsEditItemPopupOpen}"
               Placement="Center"
               StaysOpen="False">
            <local:EditItemControl DataContext="{Binding EditItemVM}" />
        </Popup>

        <!-- Add project popup -->
        <Popup IsOpen="{Binding IsAddProjectPopupOpen}"
               Placement="Center"
               StaysOpen="False">
            <local:AddProjectControl DataContext="{Binding}" />
        </Popup>
    </Grid>
</UserControl>